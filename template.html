<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Knowledge Graph Visualization</title>
    <style type="text/css">
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Arial, sans-serif;
        background-color: #ffffff;
      }

      #mynetwork {
        width: 100%;
        height: 900px;
        border: 1px solid lightgray;
        background-color: #ffffff !important;
      }

      #mynetwork canvas {
        background-color: #ffffff !important;
      }

      /* Statistics Panel - Left */
      #stats-panel {
        position: absolute;
        top: 15px;
        left: 15px;
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid #333;
        border-radius: 6px;
        padding: 10px 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        width: 200px;
      }

      #stats-panel h3 {
        margin: 0 0 8px 0;
        font-size: 14px;
        color: #333;
        border-bottom: 2px solid #333;
        padding-bottom: 5px;
      }

      .stat-row {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
        font-size: 12px;
      }

      .stat-label {
        font-weight: 600;
        color: #555;
      }

      .stat-value {
        color: #000;
      }

      /* Entity Types Panel - Right */
      #entity-types-panel {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid #333;
        border-radius: 6px;
        padding: 10px 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        width: 200px;
        max-height: 400px;
        overflow-y: auto;
      }

      #entity-types-panel h3 {
        margin: 0 0 8px 0;
        font-size: 14px;
        color: #333;
        border-bottom: 2px solid #333;
        padding-bottom: 5px;
      }

      .node-type-item {
        display: flex;
        align-items: center;
        padding: 3px 0;
        font-size: 11px;
      }

      .node-type-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
        margin-right: 6px;
        border: 1px solid #999;
        flex-shrink: 0;
      }

      .node-type-name {
        flex: 1;
        color: #444;
        font-weight: 500;
      }

      .node-type-count {
        color: #000;
        margin-left: 6px;
        font-size: 11px;
      }

      .showing-info {
        font-size: 10px;
        color: #666;
        margin-left: 2px;
      }
    </style>

    <script
      type="text/javascript"
      src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>
  </head>

  <body>
    <div id="stats-panel">
      <h3>ðŸ“Š Graph Statistics</h3>
      <div class="stat-row">
        <span class="stat-label">Entity Types:</span>
        <span class="stat-value" id="total-types">-</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Total Entities:</span>
        <span class="stat-value" id="total-entities">-</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Showing Entities:</span>
        <span class="stat-value" id="showing-entities">-</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Relationships:</span>
        <span class="stat-value" id="total-relationships">-</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Relationship Types:</span>
        <span class="stat-value" id="relationship-types">-</span>
      </div>
    </div>

    <div id="entity-types-panel">
      <h3>Entity Types</h3>
      <div id="node-types-list"></div>
    </div>

    <div id="mynetwork"></div>

    <script type="text/javascript">
      // Graph data will be injected by Python
      window.graphData = {{GRAPH_DATA_JSON}};

      console.log('Graph data loaded:', window.graphData);

      // Initialize vis.js network
      var container = document.getElementById('mynetwork');
      var data = {
          nodes: new vis.DataSet(window.graphData.nodes),
          edges: new vis.DataSet(window.graphData.edges)
      };

      var options = window.graphData.options;

      // Create network
      var network = new vis.Network(container, data, options);
      console.log('âœ… Network initialized successfully');

      // Update statistics panel
      function updateStats() {
          const data = window.graphData;

          document.getElementById('total-types').textContent = data.nodeTypes.length;
          document.getElementById('total-entities').textContent = data.totalEntities.toLocaleString();
          document.getElementById('total-relationships').textContent = data.totalRelationships.toLocaleString();
          document.getElementById('relationship-types').textContent = data.relationshipTypes;

          const totalShowing = data.nodeTypes.reduce((sum, nt) => sum + nt.showing, 0);
          document.getElementById('showing-entities').textContent = totalShowing.toLocaleString();

          const nodeTypesList = document.getElementById('node-types-list');
          nodeTypesList.innerHTML = '';

          data.nodeTypes.forEach(nodeType => {
              const item = document.createElement('div');
              item.className = 'node-type-item';

              const colorBox = document.createElement('div');
              colorBox.className = 'node-type-color';
              colorBox.style.backgroundColor = nodeType.color;

              const name = document.createElement('span');
              name.className = 'node-type-name';
              name.textContent = nodeType.type;

              const count = document.createElement('span');
              count.className = 'node-type-count';

              if (nodeType.showing < nodeType.count) {
                  count.innerHTML = `${nodeType.showing.toLocaleString()} <span class="showing-info">of ${nodeType.count.toLocaleString()}</span>`;
              } else {
                  count.textContent = nodeType.count.toLocaleString();
              }

              item.appendChild(colorBox);
              item.appendChild(name);
              item.appendChild(count);
              nodeTypesList.appendChild(item);
          });

          console.log('âœ… Statistics panel updated');
      }

      // Freeze node on hover functionality
      function setupNodeFreezing() {
          let frozenNodes = new Set();

          network.on("hoverNode", function(params) {
              const nodeId = params.node;
              frozenNodes.add(nodeId);

              const positions = network.getPositions([nodeId]);
              const pos = positions[nodeId];
              network.body.nodes[nodeId].options.fixed = {
                  x: true,
                  y: true
              };
              network.body.nodes[nodeId].x = pos.x;
              network.body.nodes[nodeId].y = pos.y;
          });

          network.on("blurNode", function(params) {
              const nodeId = params.node;
              frozenNodes.delete(nodeId);

              if (network.body.nodes[nodeId]) {
                  network.body.nodes[nodeId].options.fixed = {
                      x: false,
                      y: false
                  };
              }
          });

          console.log('âœ… Node freezing enabled');
      }

      // Initialize everything
      updateStats();
      setupNodeFreezing();
    </script>
  </body>
</html>
