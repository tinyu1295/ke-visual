<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ontology Knowledge Graph</title>
    <script
      type="text/javascript"
      src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f5f5f5;
        overflow: hidden;
      }

      #mynetwork {
        width: 100%;
        height: 100vh;
        background: #ffffff;
        border: none;
      }

      .stats {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: white;
        padding: 12px 18px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        font-size: 13px;
        color: #666;
      }

      .stats div {
        margin: 3px 0;
      }

      .stats strong {
        color: #333;
      }

      .legend {
        position: absolute;
        top: 20px;
        right: 20px;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-height: 80vh;
        overflow-y: auto;
      }

      .legend h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
        color: #333 !important;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin: 8px 0;
        font-size: 13px;
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 3px;
        margin-right: 10px;
        border: 2px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div class="stats">
      <div><strong>Nodes:</strong> <span id="nodeCount">0</span></div>
      <div><strong>Edges:</strong> <span id="edgeCount">0</span></div>
      <div><strong>Types:</strong> <span id="typeCount">0</span></div>
    </div>

    <div class="legend" id="legend">
      <h3>Entity Types</h3>
    </div>

    <div id="mynetwork"></div>

    <script type="text/javascript">
      // Graph data will be injected here by Python
      /* GRAPH_DATA_PLACEHOLDER */

      // Initialize the network
      var container = document.getElementById("mynetwork");
      var data = {
        nodes: new vis.DataSet(graphData.nodes),
        edges: new vis.DataSet(graphData.edges),
      };

      var options = {
        physics: {
          enabled: true,
          barnesHut: {
            gravitationalConstant: -20000,
            centralGravity: 0.05,
            springLength: 200,
            springConstant: 0.01,
            damping: 0.09,
            avoidOverlap: 1,
          },
          maxVelocity: 20,
          minVelocity: 0.1,
          solver: "barnesHut",
          stabilization: {
            enabled: true,
            iterations: 300,
            updateInterval: 50,
            onlyDynamicEdges: false,
            fit: true,
          },
        },
        interaction: {
          hover: true,
          tooltipDelay: 100,
          navigationButtons: true,
          keyboard: true,
          dragNodes: true,
          dragView: true,
          zoomView: true,
        },
        nodes: {
          font: {
            size: 14,
            face: "arial",
          },
        },
        edges: {
          font: {
            size: 12,
            face: "arial",
            align: "top",
          },
          smooth: {
            enabled: true,
            type: "continuous",
            roundness: 0.2,
          },
        },
      };

      var network = new vis.Network(container, data, options);

      // Update stats
      document.getElementById("nodeCount").textContent = graphData.nodes.length;
      document.getElementById("edgeCount").textContent = graphData.edges.length;

      // Count unique types (nodes starting with PARENT_)
      var typeCount = graphData.nodes.filter((n) =>
        n.id.startsWith("PARENT_")
      ).length;
      document.getElementById("typeCount").textContent = typeCount;

      // Build legend
      var legendContainer = document.getElementById("legend");
      var types = {};

      graphData.nodes.forEach(function (node) {
        if (node.id.startsWith("PARENT_")) {
          var typeName = node.id.replace("PARENT_", "");
          types[typeName] = node.color;
        }
      });

      Object.keys(types)
        .sort()
        .forEach(function (typeName) {
          var item = document.createElement("div");
          item.className = "legend-item";

          var colorBox = document.createElement("div");
          colorBox.className = "legend-color";
          colorBox.style.backgroundColor = types[typeName];

          var label = document.createElement("span");
          label.textContent = typeName;

          item.appendChild(colorBox);
          item.appendChild(label);
          legendContainer.appendChild(item);
        });

      // Freeze node on hover feature
      var originalNodePositions = {};

      network.on("hoverNode", function (params) {
        var nodeId = params.node;

        // Store original position if not already stored
        if (!originalNodePositions[nodeId]) {
          var positions = network.getPositions([nodeId]);
          originalNodePositions[nodeId] = positions[nodeId];
        }

        // Fix the node position
        data.nodes.update({
          id: nodeId,
          fixed: { x: true, y: true },
        });
      });

      network.on("blurNode", function (params) {
        var nodeId = params.node;

        // Unfreeze the node
        data.nodes.update({
          id: nodeId,
          fixed: { x: false, y: false },
        });
      });

      // Double-click to focus on a node
      network.on("doubleClick", function (params) {
        if (params.nodes.length > 0) {
          network.focus(params.nodes[0], {
            scale: 1.5,
            animation: {
              duration: 1000,
              easingFunction: "easeInOutQuad",
            },
          });
        }
      });

      // Fit graph after stabilization
      network.once("stabilizationIterationsDone", function () {
        network.fit({
          animation: {
            duration: 1000,
            easingFunction: "easeInOutQuad",
          },
        });
      });
    </script>
  </body>
</html>
